import os
import subprocess
from config import PROJECTS_DIR

def scan_with_nikto(project_name, target):
    """
    Scan a target (domain or IP) using Nikto.
    """
    print(f"[+] Scanning {target} for web vulnerabilities using Nikto...")
    try:
        # Create output directory if it doesn't exist
        output_dir = os.path.join(PROJECTS_DIR, project_name, "vulnerability_scanning")
        if not os.path.exists(output_dir):
            os.makedirs(output_dir)

        # Define output file
        output_file = os.path.join(output_dir, f"{target.replace('://', '_').replace('/', '_')}_nikto_report.txt")

        # Run Nikto scan
        nikto_command = [
            "nikto",
            "-h", target,
            "-output", output_file,
            "-Format", "txt"
        ]
        subprocess.run(nikto_command, check=True)
        print(f"[+] Nikto scan completed for {target}. Results saved to {output_file}")
    except subprocess.CalledProcessError as e:
        print(f"[-] Error scanning {target}: {e}")
    except FileNotFoundError:
        print("[-] Nikto not found. Please install Nikto and ensure it's in your PATH.")

def vulnerability_scan(project_name):
    """
    Perform a vulnerability scan for the given project using Nikto.
    """
    # Prompt the user for a domain or IP address
    target = input("Enter the domain or IP address to scan: ").strip()
    if not target:
        print("[-] Invalid input. Please provide a domain or IP address.")
        return

    # Perform Nikto scan
    scan_with_nikto(project_name, target)